---
// filepath: /Users/kurtcalacday/Documents/Projects/astro-app/src/components/Header.astro
import Container from "@components/Container.astro";
import { SITE } from "@consts";
import { cn } from "@lib/utils";
import { Button } from "@/components/ui/button";

const { pathname } = Astro.url;
const subpath = pathname.match(/[^/]+/g);

// lucide astro icons (server-rendered components, not raw <svg> tags)
import { Rss, Moon, Sun, X, Search, Menu, Home, Briefcase, FolderOpen } from "lucide-react";
---

<header id="header" class="fixed bottom-0 md:bottom-auto md:top-4 left-0 md:left-1/2 md:-translate-x-1/2 right-0 md:right-auto md:w-auto h-20 md:h-auto z-50">
  <Container size="lg">
    <div class="relative h-full w-full flex items-center justify-between md:justify-center px-4 md:px-0">
      <!-- Brand Logo (Desktop Only) -->
      <a
        href="/"
        class="hidden md:flex items-center text-current hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out absolute left-0"
      >
        <picture class="size-10">
          <img
            src="/icons/brand_black.svg"
            alt={`${SITE.TITLE} logo`}
            class="w-auto h-auto p-1 block dark:hidden"
            loading="lazy"
          />
          <img
            src="/icons/brand_white.svg"
            alt={`${SITE.TITLE} logo`}
            class="w-auto h-auto p-1 hidden dark:block"
            loading="lazy"
          />
        </picture>
      </a>

      <!-- Mobile: Brand Logo on Left -->
      <a
        href="/"
        class="md:hidden flex items-center text-current"
      >
        <picture class="size-10">
          <img
            src="/icons/brand_black.svg"
            alt={`${SITE.TITLE} logo`}
            class="w-auto h-auto p-1 block dark:hidden"
            loading="lazy"
          />
          <img
            src="/icons/brand_white.svg"
            alt={`${SITE.TITLE} logo`}
            class="w-auto h-auto p-1 hidden dark:block"
            loading="lazy"
          />
        </picture>
      </a>

      <!-- Center Dock Navigation (Desktop & Mobile) -->
      <nav id="dock-nav" class="md:relative md:left-0 md:top-0 md:translate-x-0 md:translate-y-0 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 md:flex items-center justify-center gap-2 hidden">
        <div class="glass-dock flex items-center gap-1 px-3 py-2 rounded-2xl">
          <!-- Mobile: only navigation icons -->
          <a
            href="/"
            aria-label="Home"
            class={cn(
              "md:hidden size-10 rounded-xl p-2 flex items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <Home className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <a
            href="/work"
            aria-label="Work"
            class={cn(
              "md:hidden size-10 rounded-xl p-2 flex items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/work" || "/" + subpath?.[0] === "/work"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <Briefcase className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <a
            href="/projects"
            aria-label="Projects"
            class={cn(
              "md:hidden size-10 rounded-xl p-2 flex items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/projects" || "/" + subpath?.[0] === "/projects"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <FolderOpen className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          
          <!-- Desktop: all icons -->
          <a
            href="/"
            aria-label="Home"
            class={cn(
              "hidden md:flex size-10 rounded-xl p-2 items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <Home className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <a
            href="/work"
            aria-label="Work"
            class={cn(
              "hidden md:flex size-10 rounded-xl p-2 items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/work" || "/" + subpath?.[0] === "/work"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <Briefcase className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <a
            href="/projects"
            aria-label="Projects"
            class={cn(
              "hidden md:flex size-10 rounded-xl p-2 items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/projects" || "/" + subpath?.[0] === "/projects"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <FolderOpen className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <div class="hidden md:block w-px h-6 bg-black/10 dark:bg-white/20 mx-1"></div>
          <a
            href="/search"
            aria-label={`Search on ${SITE.TITLE}`}
            class={cn(
              "hidden md:flex size-10 rounded-xl p-2 items-center justify-center",
              "transition-all duration-300 ease-in-out",
              pathname === "/search" || "/" + subpath?.[0] === "/search"
                ? "bg-black/10 dark:bg-white/20 scale-110"
                : "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <Search className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <a
            href="/rss.xml"
            target="_blank"
            rel="noopener"
            aria-label={`RSS feed for ${SITE.TITLE}`}
            class={cn(
              "hidden md:flex size-10 rounded-xl p-2 items-center justify-center",
              "transition-all duration-300 ease-in-out",
              "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
            )}
          >
            <Rss className="w-5 h-5 text-gray-900 dark:text-white" />
          </a>
          <button
            id="header-theme-button"
            aria-label="Toggle light and dark theme"
            class={cn(
              "hidden md:flex size-10 rounded-xl p-2 items-center justify-center",
              "transition-all duration-300 ease-in-out",
              "hover:bg-black/5 dark:hover:bg-white/10 hover:scale-105",
              "cursor-pointer",
            )}
          >
            <Sun className="block dark:hidden text-gray-900 w-5 h-5" />
            <Moon className="hidden dark:block text-white w-5 h-5" />
          </button>
        </div>
      </nav>

      <!-- Mobile: Hamburger Menu (Right Side) -->
      <div class="md:hidden">
        <Button
          id="header-drawer-button"
          aria-label="Toggle drawer open and closed"
          className={cn(
            "size-10 rounded-xl p-2 flex items-center justify-center",
            "bg-transparent hover:bg-black/5 dark:hover:bg-white/20",
            "transition-colors duration-300 ease-in-out",
          )}
        >
          <Menu id="drawer-open" className="text-gray-900 dark:text-white w-6 h-6" />
          <X
            id="drawer-close"
            className="hidden text-gray-900 dark:text-white w-6 h-6"
          />
        </Button>
      </div>
    </div>
  </Container>
</header>

<style>
  #header-drawer-button > #drawer-open {
    @apply block;
  }
  #header-drawer-button > #drawer-close {
    @apply hidden;
  }
  #header-drawer-button.open > #drawer-open {
    @apply hidden;
  }
  #header-drawer-button.open > #drawer-close {
    @apply block;
  }
</style>

<script type="module">
  import "/js/drawer.js";
  import "/js/theme.js";
  
  function initializeHeader() {
    // Show dock nav on desktop, hide on mobile when drawer is open
    const dockNav = document.getElementById('dock-nav');
    const drawerButton = document.getElementById('header-drawer-button');
    
    function updateDockVisibility() {
      if (dockNav) {
        const isMobile = window.innerWidth < 768;
        const isDrawerOpen = drawerButton?.classList.contains('open');
        
        if (isMobile) {
          // On mobile, hide dock when drawer is open
          dockNav.style.display = isDrawerOpen ? 'none' : 'flex';
        } else {
          // On desktop, always show dock
          dockNav.style.display = 'flex';
        }
      }
    }
    
    // Initial check
    updateDockVisibility();
    
    // Update on resize
    window.addEventListener('resize', updateDockVisibility);
    
    // Update when drawer toggles
    if (drawerButton) {
      const observer = new MutationObserver(updateDockVisibility);
      observer.observe(drawerButton, { attributes: true, attributeFilter: ['class'] });
    }
  }
  
  // Initialize on load and after Astro swaps
  document.addEventListener("astro:after-swap", () => {
    initializeDrawerButton();
    initializeHeader();
  });
  initializeDrawerButton();
  initializeHeader();
</script>
