---
import { Sparkle } from "lucide-react";
/**
 * TwinkleStars.astro
 * This component creates twinkling stars that are appended to the galaxy on interval.
 * Twinkle stars are removed from the document after the animation is completed.
 * The svg below is just a template for the script to clone and append to the galaxy.
 */
---

<Sparkle
  id="twinkle-star"
  className="template absolute left-full animate-twinkle text-transparent dark:text-white"
  size="149"
  aria-hidden="true"
/>

<script is:inline>
  // Generate a twinkle star and append it to the galaxy, remove it after animation.
  function generateTwinkleStar() {
    const twinkleStarTemplate = document.getElementById("twinkle-star");
    if (!twinkleStarTemplate) {
      return;
    }
    // Clone the twinkle star template and set its attributes.
    const twinkleStar = twinkleStarTemplate.cloneNode(true);
    // make the clone visible and prepare animation
    twinkleStar.classList.remove("template");
    twinkleStar.style.visibility = "visible";
    // Ensure color respects the user's preferred color scheme: show white in dark mode, hide in light mode
    try {
      const prefersDark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      twinkleStar.style.color = prefersDark ? "white" : "transparent";
    } catch (e) {
      // fallback: keep white
      twinkleStar.style.color = "white";
    }
    twinkleStar.style.left = twinkleStar.style.left; // ensure inline left exists
    twinkleStar.style.top = twinkleStar.style.top;
    twinkleStar.style.opacity = "0";
    twinkleStar.style.transform = "scale(0.6) rotate(0deg)";
    twinkleStar.style.position = "absolute";
    twinkleStar.style.left =
      Math.floor(Math.random() * window.innerWidth) + "px";
    twinkleStar.style.top =
      Math.floor(Math.random() * (window.innerHeight / 3)) + "px";
    twinkleStar.style.width =
      window.innerWidth < 768
        ? Math.floor(Math.random() * (15 - 7.5 + 1) + 7.5) + "px"
        : Math.floor(Math.random() * (30 - 15 + 1) + 15) + "px";
    twinkleStar.style.height = twinkleStar.style.width;
    twinkleStar.classList.add("twinkle");
    document.getElementById("galaxy").appendChild(twinkleStar);

    // Remove the twinkle star after the animation completes
    twinkleStar.addEventListener(
      "animationend",
      () => {
        twinkleStar.remove();
      },
      { once: true },
    );
  }

  setInterval(generateTwinkleStar, 350);
</script>
